<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf8">
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
    <link rel="stylesheet" href="css/index.css">

    <link rel="stylesheet" href="css/sm.min.css">
    <script type='text/javascript' src='js/zepto.min.js' charset='utf-8'></script>
    <script type='text/javascript' src='js/sm.min.js' charset='utf-8'></script>
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=rsgXNasQAtvmUr7rPO02T6itkXSk1fhU"></script>


    <title>Hello World</title>
  </head>
<body>

<div class="page" id="map">
  <header class="bar bar-nav">
    <a  class="icon icon-left pull-left " href="javascript:$.router.back();"></a>
    <h1 class="title">我的订单</h1>
    <a  class="icon icon-menu pull-right open-panel"></a>
  </header>
  <nav class="bar bar-tab">
      <a class="tab-item active" href="index.html#index">
          <span class="icon icon-home"></span>
          <span class="tab-label">Index</span>
      </a>
      <a class="tab-item" href="#">
          <span class="icon icon-gift"></span>
          <span class="tab-label">Order</span>
      </a>
      <a class="tab-item" href="#">
          <span class="icon icon-message"></span>
          <span class="tab-label">Message</span>
      </a>
      <a class="tab-item" href="me.html">
          <span class="icon icon-me"></span>
          <span class="tab-label">Me</span>
      </a>
  </nav>
  <div class="content">
    <div id="allmap"></div>
  </div>
</div>
<script type="text/javascript">
$.init();

  // 百度地图API功能
  var map = new BMap.Map("allmap");
  var point = new BMap.Point(116.331398,39.897445);
  map.centerAndZoom(point,16);
  var myPosition;

  /*初始化定位*/
  var geolocation = new BMap.Geolocation();
  geolocation.getCurrentPosition(function(r){
    if(this.getStatus() == BMAP_STATUS_SUCCESS){
      var mk = new BMap.Marker(r.point);
      myPosition = r;
      map.panTo(r.point);
      map.addOverlay(mk);
      mk.setAnimation( BMAP_ANIMATION_BOUNCE );
      
      
      // alert('您的位置：'+r.point.lng+','+r.point.lat);
    }
    else {
      alert('failed'+this.getStatus());
    }        
  },{enableHighAccuracy: true})


  /*清理标注并重新初始化定位*/
  function relocate(){
    map.clearOverlays();
    geolocation.getCurrentPosition(function(r){
      if(this.getStatus() == BMAP_STATUS_SUCCESS){
        var mk = new BMap.Marker(r.point);
        map.panTo(r.point);
        map.addOverlay(mk);
        mk.setAnimation( BMAP_ANIMATION_BOUNCE ); 
        myPosition = r;     
        
        // alert('您的位置：'+r.point.lng+','+r.point.lat);
      }
      else {
        alert('failed'+this.getStatus());
      }        
    },{enableHighAccuracy: true})
  }

  function searchPower(){
    
    var local = new BMap.LocalSearch(map, {
      renderOptions:{map: map}
    });
    var radius = 10000000;
    var center = myPosition.point;

    local.searchNearby("test", center, radius,{customData:{geotableId:140069}});


  }
</script>
</body>
</html>